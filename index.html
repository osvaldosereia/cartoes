<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-M-^T">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Clientes</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Ícones Lucide -->
    <script src="https://unpkg.com/lucide-react@0.395.0/dist/umd/lucide.min.js"></script>
    <style>
        /* Fonte Padrão */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Para esconder a scrollbar em elementos */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen text-gray-800">

    <div class="max-w-4xl mx-auto p-4 md:p-6">

        <!-- 1. PAINEL DE CONTROLE (Dashboard) -->
        <header class="mb-6">
            <h1 class="text-3xl font-bold text-gray-900 mb-4">Painel de Controle</h1>

            <!-- Filtros de Data -->
            <div class="flex flex-col sm:flex-row gap-4 mb-4">
                <div class="flex-1">
                    <label for="date-start" class="block text-sm font-medium text-gray-700">Data Início</label>
                    <!-- Aprimoramento Visual: Wrapper com ícone -->
                    <div class="relative mt-1">
                        <input type="date" id="date-start" class="w-full pl-10 pr-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i data-lucide="calendar" class="w-5 h-5 text-gray-400"></i>
                        </div>
                    </div>
                </div>
                <div class="flex-1">
                    <label for="date-end" class="block text-sm font-medium text-gray-700">Data Fim</label>
                    <!-- Aprimoramento Visual: Wrapper com ícone -->
                    <div class="relative mt-1">
                        <input type="date" id="date-end" class="w-full pl-10 pr-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i data-lucide="calendar" class="w-5 h-5 text-gray-400"></i>
                        </div>
                    </div>
                </div>
                <div class="flex-shrink-0 self-end">
                    <button id="btn-filter" class="w-full sm:w-auto bg-indigo-600 text-white px-4 py-3 rounded-lg shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                        Filtrar
                    </button>
                </div>
            </div>

            <!-- Stats do Dashboard -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-white p-4 rounded-lg shadow">
                    <h3 class="text-sm font-medium text-gray-500">Total Clientes</h3>
                    <p id="stat-total-clientes" class="mt-1 text-2xl font-semibold text-gray-900">0</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h3 class="text-sm font-medium text-gray-500">Saldo Total (R$)</h3>
                    <p id="stat-saldo-total" class="mt-1 text-2xl font-semibold text-gray-900">R$ 0,00</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h3 class="text-sm font-medium text-gray-500">Comissão (R$)</h3>
                    <p id="stat-comissao-total" class="mt-1 text-2xl font-semibold text-gray-900">R$ 0,00</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h3 class="text-sm font-medium text-gray-500">Comissão Média (%)</h3>
                    <p id="stat-comissao-media" class="mt-1 text-2xl font-semibold text-gray-900">0,00%</p>
                </div>
            </div>

            <!-- Botões de Backup de Transações -->
            <div class="flex gap-4 mt-6">
                <button id="btn-import-transactions" class="flex-1 bg-white text-gray-700 px-4 py-2 rounded-md shadow-sm border border-gray-300 hover:bg-gray-50">
                    Importar Transações (.json)
                </button>
                <input type="file" id="file-importer" class="hidden" accept=".json">
                <button id="btn-export-transactions" class="flex-1 bg-green-600 text-white px-4 py-2 rounded-md shadow-sm hover:bg-green-700">
                    Exportar Transações (.json)
                </button>
            </div>
        </header>

        <!-- 2. BUSCA DE CLIENTES -->
        <main>
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Buscar Cliente</h2>
            <!-- NOVO: Contêiner de Filtros de Busca -->
            <div class="flex flex-col md:flex-row gap-4 mb-4">
                <!-- Filtro de Texto -->
                <div class="relative flex-grow">
                    <input type="search" id="search-input" placeholder="Digite o nome, empresa ou ID..." class="w-full pl-10 pr-4 py-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i data-lucide="search" class="w-5 h-5 text-gray-400"></i>
                    </div>
                </div>
                <!-- NOVO: Filtro de Saldo -->
                <div class="relative w-full md:w-64">
                    <select id="filter-saldo" class="w-full pl-10 pr-10 py-3 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 appearance-none sm:text-sm">
                        <option value="todos">Filtrar por Saldo...</option>
                        <option value="positivo">Saldo Positivo (Todos)</option>
                        <option value="0-500">Saldo até R$ 500</option>
                        <option value="501-1000">Saldo R$ 501 a R$ 1000</option>
                        <option value="1001+">Saldo Acima de R$ 1000</option>
                        <option value="zero">Saldo Zero</option>
                        <option value="negativo">Saldo Negativo</option>
                    </select>
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i data-lucide="dollar-sign" class="w-5 h-5 text-gray-400"></i>
                    </div>
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400"></i>
                    </div>
                </div>
            </div>

            <!-- 3. CONTAINER DE RESULTADOS -->
            <div id="search-results" class="mt-6 space-y-4">
                <!-- Os cards dos clientes serão inseridos aqui pelo app.js -->
            </div>
        </main>

    </div>

    <!-- 4. TEMPLATE DO CARD DO CLIENTE (Oculto) -->
    <template id="client-card-template">
        <div class="bg-white rounded-lg shadow-md overflow-hidden transition-all duration-300">
            <!-- Seção Principal (Sempre Visível) -->
            <div class="p-4">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-xl font-bold text-indigo-700" data-field="nome">Nome do Cliente</h3>
                        <p class="text-sm text-gray-600" data-field="bandeira">Bandeira</p>
                    </div>
                    <!-- Botão WhatsApp -->
                    <a href="#" data-action="whatsapp" target="_blank" class="flex-shrink-0 bg-green-500 text-white p-2 rounded-full hover:bg-green-600 shadow-sm">
                        <i data-lucide="message-circle" class="w-5 h-5"></i>
                    </a>
                </div>

                <div class="grid grid-cols-2 gap-4 mt-4">
                    <div>
                        <p class="text-sm font-medium text-gray-500">Saldo Atual</p>
                        <p class="text-2xl font-semibold text-gray-900" data-field="saldo">R$ 0,00</p>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-500">Senha</p>
                        <p class="text-2xl font-semibold text-gray-900" data-field="senha">***</p>
                    </div>
                </div>

                <!-- Botões de Ação (Entrada/Saída) -->
                <div class="flex gap-4 mt-4">
                    <button data-action="add-entry" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-md shadow-sm hover:bg-blue-700 flex items-center justify-center gap-2">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        <span>Entrada</span>
                    </button>
                    <button data-action="add-exit" class="flex-1 bg-red-600 text-white px-4 py-2 rounded-md shadow-sm hover:bg-red-700 flex items-center justify-center gap-2">
                        <i data-lucide="minus" class="w-4 h-4"></i>
                        <span>Saída</span>
                    </button>
                </div>
            </div>

            <!-- Botão de "Mais Detalhes" -->
            <button data-action="toggle-details" class="w-full bg-gray-50 text-gray-600 p-2 text-sm font-medium hover:bg-gray-100 flex items-center justify-center gap-2 border-t border-gray-200">
                <span class="details-label">Ver Mais Detalhes</span>
                <i data-lucide="chevron-down" class="w-4 h-4 transition-transform duration-300 details-icon"></i>
            </button>

            <!-- Seção Retrátil (Oculta por padrão) -->
            <div class="details-section hidden p-4 border-t border-gray-200 bg-gray-50">
                
                <!-- Últimos Lançamentos -->
                <h4 class="text-md font-semibold text-gray-800 mb-2">Últimos Lançamentos</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <!-- Entradas -->
                    <div>
                        <h5 class="text-sm font-medium text-blue-600 mb-1">Entradas</h5>
                        <ul data-list="entradas" class="text-sm text-gray-700 space-y-1">
                            <!-- JS irá preencher aqui -->
                            <li class="text-gray-400 italic">Nenhuma entrada recente.</li>
                        </ul>
                    </div>
                    <!-- Saídas -->
                    <div>
                        <h5 class="text-sm font-medium text-red-600 mb-1">Saídas</h5>
                        <ul data-list="saidas" class="text-sm text-gray-700 space-y-1">
                            <!-- JS irá preencher aqui -->
                            <li class="text-gray-400 italic">Nenhuma saída recente.</li>
                        </ul>
                    </div>
                </div>

                <!-- Informações Cadastrais -->
                <h4 class="text-md font-semibold text-gray-800 mb-2">Informações Cadastrais</h4>
                <div classs="space-y-1 text-sm text-gray-700">
                    <p><strong>Empresa:</strong> <span data-field="empresa"></span></p>
                    <p><strong>Celular:</strong> <span data-field="celular"></span></p>
                    <p><strong>Vendedor:</strong> <span data-field="vendedor"></span></p>
                    <p><strong>Comissão:</strong> <span data-field="comissaoPct"></span>%</p>
                    <p><strong>Endereço:</strong> <span data-field="enderecoCompleto"></span></p>
                </div>
            </div>
        </div>
    </template>

    <!-- 5. MODAL DE TRANSAÇÃO (Oculto) -->
    <div id="transaction-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6">
            <h2 id="modal-title" class="text-xl font-bold mb-4">Nova Transação</h2>
            <form id="transaction-form">
                <!-- Campo escondido para tipo (entrada/saida) e clienteId -->
                <input type="hidden" id="modal-transaction-type">
                <input type="hidden" id="modal-client-id">
                
                <div class="mb-4">
                    <label for="modal-value" class="block text-sm font-medium text-gray-700">Valor (R$)</label>
                    <input type="number" id="modal-value" step="0.01" placeholder="0,00" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
                </div>
                <div class="mb-6">
                    <label for="modal-date" class="block text-sm font-medium text-gray-700">Data</label>
                    <input type="date" id="modal-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
                </div>
                
                <div class="flex gap-4">
                    <button type="button" id="btn-modal-cancel" class="flex-1 bg-white text-gray-700 px-4 py-2 rounded-md shadow-sm border border-gray-300 hover:bg-gray-50">
                        Cancelar
                    </button>
                    <button type="submit" id="btn-modal-save" class="flex-1 bg-indigo-600 text-white px-4 py-2 rounded-md shadow-sm hover:bg-indigo-700">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 6. MODAL DE IMPORTAÇÃO/EXPORTAÇÃO (Oculto) -->
    <div id="io-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6">
            <h2 id="io-modal-title" class="text-xl font-bold mb-4">Exportar Transações</h2>
            <p id="io-modal-description" class="text-sm text-gray-600 mb-2">Copie o texto abaixo e salve em um arquivo .json para fazer seu backup.</p>
            <textarea id="io-modal-textarea" readonly class="w-full h-48 p-2 border border-gray-300 rounded-md font-mono text-xs bg-gray-50 no-scrollbar"></textarea>
            <!-- CORREÇÃO: 'class_' alterado para 'class' -->
            <button id="btn-io-modal-close" class="mt-4 w-full bg-indigo-600 text-white px-4 py-2 rounded-md shadow-sm hover:bg-indigo-700">
                Fechar
            </button>
        </div>
    </div>

    <!-- 7. MODAL DE ALERTA (Oculto) -->
    <!-- NOVO: Modal para substituir os 'alert()' -->
    <div id="alert-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 hidden z-[60]">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6">
            <h2 id="alert-modal-title" class="text-xl font-bold mb-4">Aviso</h2>
            <p id="alert-modal-message" class="text-gray-700 mb-6">Mensagem de aviso aqui.</p>
            <button id="btn-alert-modal-close" class="w-full bg-indigo-600 text-white px-4 py-2 rounded-md shadow-sm hover:bg-indigo-700">
                OK
            </button>
        </div>
    </div>

    <!-- 8. SCRIPT PRINCIPAL -->
    <script src="app.js" type="module"></script>

    <!-- Script para inicializar ícones -->
    <script>
        lucide.createIcons();
    </script>
</body>
</html>

